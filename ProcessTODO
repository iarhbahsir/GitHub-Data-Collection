#!/bin/bash
# take input for desired username/repo
# git clone desired repo
# find all .java files in cloned directory
# output list of java files to a .txt file
# run TodoReader java tool on the file of results to:
# write all TODO tasks to a .txt file (name based on commit #, new file for every commit, new folder for every repo, create folder if doesn't exist)
echo Enter username
userName=iarhbahsir
#read userName
echo Enter repo name
#read repoName
repoName=GitHub-Data-Collection

CLONED_DIR="Cloned"
mkdir ${CLONED_DIR}

if test -d ${CLONED_DIR}/$repoName; then
    rm -rf ${CLONED_DIR}/$repoName
    echo deleted
fi

git clone https://github.com/$userName/$repoName ${CLONED_DIR}/$repoName

# Check if we successfully cloned.
if [ ! -d ${CLONED_DIR}/$repoName ]; then
    echo "There is not directory cloned $repoName"
    exit 1
fi

baseName=-JavaFiles.txt
find ${CLONED_DIR}/$repoName/ -name "*.java" > $repoName$baseName 
echo finished

cd ${CLONED_DIR}/$repoName
# git log --pretty=format:"Abv. Hash: %h  Date: %cd"
file="output.txt"
rm -f ${file}

numCommits=$(git rev-list HEAD | wc -l)
for((i=1; i<$numCommits; i++)); do
    declare -i j=$i-1
    git log | sed -n '1p' >> ${file}
    git diff HEAD~$i..HEAD~$j >> ${file}
done
